= Rest APIs - Configuration
:page-sidebar: apim_3_x_sidebar
:page-permalink: apim/3.x/apim_installguide_rest_apis_configuration.html
:page-folder: apim/installation-guide/rest-apis
:page-description: Gravitee.io API Management - Configuration - Management API
:page-keywords: Gravitee.io, API Platform, API Management, API Gateway, oauth2, openid, documentation, manual, guide, reference, api
:page-layout: apim3x

include::../../partial/how-to-configure.adoc[leveloffset=+1]

== HTTP Server

Management API HTTP server configuration.

[source,yaml]
----
jetty:
  port: 8083
  idleTimeout: 30000
  acceptors: -1
  selectors: -1
  pool:
    minThreads: 10
    maxThreads: 200
    idleTimeout: 60000
    queueSize: 6000
  jmx: false
  statistics: false
  accesslog:
    enabled: true
    path: ${gravitee.home}/logs/gravitee_accesslog_yyyy_mm_dd.log
----

=== How to enable HTTPS support
First, you need to provide a keystore. If you don't have one, you can generate it :
[source,bash]
----
keytool -genkey \
  -alias test \
  -keyalg RSA \
  -keystore server-keystore.jks \
  -keysize 2048 \
  -validity 360 \
  -dname CN=localhost \
  -keypass secret \
  -storepass secret
----

After that, you have to enable secure mode in your `gravitee.yml` :
[source,yaml]
----
jetty:
  ...
  secured: true
  ssl:
    keystore:
      path: ${gravitee.home}/security/keystore.jks
      password: secret
    truststore:
      path: ${gravitee.home}/security/truststore.jks
      password: secret
----

WARNING: Truststore and keystore defined within `jetty` section are only used to secure access to the Management API. These are not
used by any HTTP client calls for other purposes (Fetch, DCR, ...)

== Management & Portal APIs
This block allow to select which API should be started. By default, both Management and Portal are started. +
You can also configure the endpoint of each API. By default `/management` and `/portal`.

[source,yaml]
----
http:
  api:
    # Configure the listening path for the API. Default to /
#    entrypoint: /
    # Configure Management API and Portal API.
#    management:
#      enabled: true
#      entrypoint: ${http.api.entrypoint}management
#    portal:
#      enabled: true
#      entrypoint: ${http.api.entrypoint}portal
----

== Plugins repository

Gravitee.io Rest APIs <<gravitee-plugins,plugins>> directory configuration.

[source,yaml]
----
plugins:
  path: ${gravitee.home}/plugins
----

== Management repository

Management repository is used to store global configuration such as APIs, applications, apikeys, ...
This is the default configuration using MongoDB (single server). For more information about MongoDB configuration, please have a look to:

http://api.mongodb.org/java/current/com/mongodb/MongoClientOptions.html

[source,yaml]
----
management:
  type: mongodb
  mongodb:
    dbname: ${ds.mongodb.dbname}
    host: ${ds.mongodb.host}
    port: ${ds.mongodb.port}
#    username:
#    password:
#    connectionsPerHost: 0
#    connectTimeout: 500
#    maxWaitTime: 120000
#    socketTimeout: 500
#    socketKeepAlive: false
#    maxConnectionLifeTime: 0
#    maxConnectionIdleTime: 0
#    serverSelectionTimeout: 0
#    description: gravitee.io
#    heartbeatFrequency: 10000
#    minHeartbeatFrequency: 500
#    heartbeatConnectTimeout: 1000
#    heartbeatSocketTimeout: 20000
#    localThreshold: 15
#    minConnectionsPerHost: 0
#    sslEnabled: false
#    threadsAllowedToBlockForConnectionMultiplier: 5
#    cursorFinalizerEnabled: true

# Management repository: single MongoDB using URI
# For more information about MongoDB configuration using URI, please have a look to:
# - http://api.mongodb.org/java/current/com/mongodb/MongoClientURI.html
#management:
#  type: mongodb
#  mongodb:
#    uri: mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]

# Management repository: clustered MongoDB
#management:
#  type: mongodb
#  mongodb:
#    servers:
#      - host: mongo1
#        port: 27017
#      - host: mongo2
#        port: 27017
#    dbname: ${ds.mongodb.dbname}
#    connectTimeout: 500
#    socketTimeout: 250
----

== Analytics

Analytics repository is used to store all reporting, metrics, health-checks stored by gateway instances.

This is the default configuration using https://www.elastic.co/products/elasticsearch[Elasticsearch].

[source,yaml]
----
  type: elasticsearch
  elasticsearch:
    endpoints:
      - http://localhost:9200
#    index: gravitee
#    security:
#       username:
#       password:
----

[[gravitee-standalone-management-authentication-configuration]]
== Authentication

See the link:/apim/3.x/apim_installguide_authentication.html[Authentication configuration] section.

== CORS

CORS (Cross-Origin Resource Sharing) is a mechanism that allows resources on a web page to be requested from another domain.

For more information on CORS, take a look at the https://www.w3.org/TR/cors[CORS specification^].

=== Configuration

You can configure CORS using `gravitee.yml`, environment variables or directly in APIM Console.

[source,yaml]
----
cors:
  # Allows to configure the header Access-Control-Allow-Origin (default value: *)
  # '*' is a valid value but is considered as a security risk as it will be opened to cross origin requests from anywhere.
  allow-origin: http://developer.mycompany.com
  # Allows to define how long the result of the preflight request should be cached for (default value; 1728000 [20 days])
  max-age: 864000
  # Which methods to allow (default value: OPTIONS, GET, POST, PUT, DELETE)
  allow-methods: 'OPTIONS, GET, POST, PUT, DELETE'
  # Which headers to allow (default values: Cache-Control, Pragma, Origin, Authorization, Content-Type, X-Requested-With, If-Match, X-Xsrf-Token)
  allow-headers: 'X-Requested-With'
----

image::apim/3.x/installation/configuration/graviteeio-installation-configuration-cors.png[]

== Sending emails

=== SMTP

SMTP configuration used to send mails.

You can configure SMTP using `gravitee.yml`, environment variables or directly in APIM Management.

[source,yaml]
----
email:
  host: smtp.my.domain
  port: 465
  from: noreply@my.domain
  subject: "[Gravitee.io] %s"
  username: user@my.domain
  password: password
----

image::apim/3.x/installation/configuration/graviteeio-installation-configuration-smtp.png[]

==== Configure the Gmail SMTP server

Here is the Gmail SMTP configuration.

[source,yaml]
----
email:
  enabled: true
  host: smtp.gmail.com
  port: 587
  from: user@gmail.com
  subject: "[Gravitee.io] %s"
  username: user@gmail.com
  password: xxxxxxxx
  properties:
    auth: true
    starttls.enable: true
    ssl.trust: smtp.gmail.com
----

If you're using the 2-Factor Authentication (if not, you should), you have to generate an application password : https://security.google.com/settings/security/apppasswords .

== User options

You can configure various user options:

user.login.defaultApplication:: boolean (default: true) -- creates a new application for all new users
user.creation.token.expire-after:: number (default: 86400) -- number of seconds before the user registration token expires
user.reference.secret:: 32 characters (default: s3cR3t4grAv1t33.1Ous3D4R3f3r3nc3) -- secret used to generate a unique anonymous reference to a user; *You must change this value*
user.anonymize-on-delete:enabled:: boolean (default: false) - If true, the user *firstname*, *lastname* and *email* are anonymized when a user is deleted

== Management settings

You can configure various management settings from the APIM Console `Settings` section with environment variables. For a complete list of these settings, see <<management-settings-list,Management settings list>> below.
Once you override these properties with environment variables, APIM Console configures them as read-only to prevent you overwriting the new values in the interface.

[NOTE]
====
- For array properties, separate your environment variable properties with a comma. For example: `my_var=item1,item2,item3`.
- We recommend you prefix Gravitee variables with `gravitee.` to avoid conflicts with other variables.
====

=== Example
For example, to override the analytics client timeout, you can write:

[source,properties]
----
GRAVITEE_ANALYTICS_CLIENT_TIMEOUT=15000
GRAVITEE.ANALYTICS.CLIENT.TIMEOUT=15000
gravitee_analytics_client_timeout=15000
gravitee.analytics.client.timeout=15000
----

=== Management settings list

[source,java]
----
include::https://raw.githubusercontent.com/gravitee-io/gravitee-management-rest-api/master/gravitee-rest-api-model/src/main/java/io/gravitee/rest/api/model/parameters/Key.java[]
----

== Default configuration

Various properties can be specified inside your `GRAVITEE_HOME/config/gravitee.yml` file. This section provides the general configuration of Gravitee.IO Management API.

[source,yaml]
----
include::https://raw.githubusercontent.com/gravitee-io/gravitee-management-rest-api/master/gravitee-rest-api-standalone/gravitee-rest-api-standalone-distribution/src/main/resources/config/gravitee.yml[]
----
